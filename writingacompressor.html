<!-- HTML header for doxygen 1.9.5-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>libpressio: Writing a Compressor Plugin</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-9KQE44SX6K"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-9KQE44SX6K",{anonymize_ip:!1})}</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">libpressio<span id="projectnumber">&#160;0.93.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Writing a Compressor Plugin </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p ><a class="anchor" id="md_docs_WritingACompressorPlugin"></a> Libpressio supports adding custom compressor plugins.</p>
<p >To create a compressor plugin, simply create a subclass of <code><a class="el" href="classlibpressio__compressor__plugin.html">libpressio_compressor_plugin</a></code> that implements the compressor functions that you are interested in, and register the plugin with libpressio.</p>
<p >For example, let's create a compressor plugin that preforms a log transform as a preprocessing step to compression, and does a exponential transformation as a post processing step to decompression. Some scientific data compresses much better in the log domain than in the normal domain.</p>
<p >First you will need to include several headers.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;cmath&gt;</span> <span class="comment">//for exp and log</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="data_8h.html">libpressio_ext/cpp/data.h</a>&quot;</span> <span class="comment">//for access to pressio_data structures</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="compressor_8h.html">libpressio_ext/cpp/compressor.h</a>&quot;</span> <span class="comment">//for the libpressio_compressor_plugin class</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="options_8h.html">libpressio_ext/cpp/options.h</a>&quot;</span> <span class="comment">// for access to pressio_options</span></div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="libpressio__ext_2cpp_2pressio_8h.html">libpressio_ext/cpp/pressio.h</a>&quot;</span> <span class="comment">//for the plugin registries</span></div>
<div class="ttc" id="acompressor_8h_html"><div class="ttname"><a href="compressor_8h.html">compressor.h</a></div><div class="ttdoc">an extension header for adding compressor plugins to libpressio</div></div>
<div class="ttc" id="adata_8h_html"><div class="ttname"><a href="data_8h.html">data.h</a></div><div class="ttdoc">C++ pressio_data interface.</div></div>
<div class="ttc" id="alibpressio__ext_2cpp_2pressio_8h_html"><div class="ttname"><a href="libpressio__ext_2cpp_2pressio_8h.html">pressio.h</a></div><div class="ttdoc">C++ interface to the compressor loader.</div></div>
<div class="ttc" id="aoptions_8h_html"><div class="ttname"><a href="options_8h.html">options.h</a></div><div class="ttdoc">C++ pressio_options and pressio_option interfaces.</div></div>
</div><!-- fragment --><p >First we are going to delegate most of the methods to the underlying compressor. To do so, we are going to do this in one of the most naive was possible and accept the compressor as a constructor argument. Then we are going to provide overrides that pass each of the methods to the underlying compressor.</p>
<p >Notice the function <code>check_error</code>. Since we are using composition rather than inheritance, we need to propagate error messages to our wrapper. The <code>check_error</code> function simply check for the error condition in the underlying function and propagates the error if these is one.</p>
<p >Also notice that we are using the <code>_impl</code> versions of the various methods. This is because the base class is doing some work to provide metrics functionality and basic error checking that we want to use.</p>
<div class="fragment"><div class="line"><span class="keyword">class </span>log_transform : <span class="keyword">public</span> <a class="code hl_class" href="classlibpressio__compressor__plugin.html">libpressio_compressor_plugin</a> {</div>
<div class="line">  <span class="keyword">public</span>:</div>
<div class="line">  <span class="comment">//getting and setting options/configuration</span></div>
<div class="line">  <a class="code hl_struct" href="structpressio__options.html">pressio_options</a> <a class="code hl_function" href="classlibpressio__compressor__plugin.html#aebe330db97b251195ef853360dbf4d0d">get_options_impl</a>()<span class="keyword"> const override </span>{</div>
<div class="line">    <a class="code hl_struct" href="structpressio__options.html">pressio_options</a> options;</div>
<div class="line">    <a class="code hl_function" href="classpressio__configurable.html#a4e23406b411d76d1a73460d32a7ead93">set_meta</a>(options, <span class="stringliteral">&quot;log:compressor&quot;</span>, compressor_id, compressor);</div>
<div class="line">    <span class="keywordflow">return</span> options;</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordtype">int</span> <a class="code hl_function" href="classlibpressio__compressor__plugin.html#a2180d5ded80457937a4253ca792805b7">set_options_impl</a>(<a class="code hl_struct" href="structpressio__options.html">pressio_options</a> <span class="keyword">const</span>&amp; options)<span class="keyword"> override </span>{</div>
<div class="line">    <a class="code hl_function" href="classpressio__configurable.html#acbd725596c83e011de4fcc23924c7526">get_meta</a>(options, <span class="stringliteral">&quot;log:compressor&quot;</span>, <a class="code hl_function" href="libpressio__ext_2cpp_2pressio_8h.html#abdbb1e0c6163691c0f6be9a620d933fb">compressor_plugins</a>(), compressor_id, compressor)</div>
<div class="line">    <span class="keywordflow">return</span> rc;</div>
<div class="line">  }</div>
<div class="line">  <a class="code hl_struct" href="structpressio__options.html">pressio_options</a> <a class="code hl_function" href="classlibpressio__compressor__plugin.html#ac7575b101042e5c216438e595af3c196">get_configuration_impl</a>()<span class="keyword"> const override </span>{</div>
<div class="line">    <span class="keywordflow">return</span> compressor.plugin-&gt;get_configuration();</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordtype">int</span> <a class="code hl_function" href="classlibpressio__compressor__plugin.html#a3d2eda400213bf2a00d640328e6e8c75">check_options_impl</a>(<a class="code hl_struct" href="structpressio__options.html">pressio_options</a> <span class="keyword">const</span>&amp; options)<span class="keyword"> override </span>{</div>
<div class="line">    <span class="keywordflow">return</span> check_error(compressor.plugin-&gt;check_options(options));</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="comment">//getting version information</span></div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code hl_function" href="classpressio__configurable.html#aa2b9ef24dd11b7c4a0678712567ab16a">prefix</a>()<span class="keyword"> const override </span>{</div>
<div class="line">    <span class="keywordflow">return</span> <span class="stringliteral">&quot;log&quot;</span>;</div>
<div class="line">  }</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code hl_function" href="classpressio__versionable.html#a0d148c3274175e224786f2618db3804e">version</a>()<span class="keyword"> const override </span>{</div>
<div class="line">    <span class="keywordflow">return</span> <span class="stringliteral">&quot;0.1.0&quot;</span>;</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordtype">int</span> <a class="code hl_function" href="classpressio__versionable.html#af06e9af0f0af870c16358ca63596f6b9">major_version</a>()<span class="keyword"> const override </span>{</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordtype">int</span> <a class="code hl_function" href="classpressio__versionable.html#aa18a0cf29f56b2ec2cdf242c22ce3786">minor_version</a>()<span class="keyword"> const override </span>{</div>
<div class="line">    <span class="keywordflow">return</span> 1;</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordtype">int</span> <a class="code hl_function" href="classpressio__versionable.html#a1f1a2cf24aa1371a752d764a63b833d9">patch_version</a>()<span class="keyword"> const override </span>{</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">  }</div>
<div class="line">  std::shared_ptr&lt;libpressio_compressor_plugin&gt; <a class="code hl_function" href="classlibpressio__compressor__plugin.html#afa06c343a62ff161e02c6b2a65fd31d6">clone</a>()<span class="keyword"> override </span>{</div>
<div class="line">    <span class="keywordflow">return</span> compat::make_unique&lt;log_transform&gt;(*<span class="keyword">this</span>);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">private</span>:</div>
<div class="line">  <span class="keywordtype">void</span> <a class="code hl_function" href="classpressio__configurable.html#ab9878c5ada9274daae95d743277c04a9">set_name_impl</a>(std::string <span class="keyword">const</span>&amp; new_name)<span class="keyword"> override </span>{</div>
<div class="line">    compressor-&gt;set_name(new_name + <span class="stringliteral">&quot;/&quot;</span> + compressor-&gt;prefix());</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="keywordtype">int</span> check_error(<span class="keywordtype">int</span> rc) { </div>
<div class="line">    <span class="keywordflow">if</span>(rc) {</div>
<div class="line">      <a class="code hl_function" href="classpressio__errorable.html#ac88d68b1d28f24cf984fd2d2e7fc3bf4">set_error</a>(compressor-&gt;error_code(), compressor-&gt;error_msg());</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> rc;</div>
<div class="line">  }</div>
<div class="line">  <a class="code hl_struct" href="structpressio__compressor.html">pressio_compressor</a> compressor = <a class="code hl_function" href="libpressio__ext_2cpp_2pressio_8h.html#abdbb1e0c6163691c0f6be9a620d933fb">compressor_plugins</a>().build(<span class="stringliteral">&quot;noop&quot;</span>);</div>
<div class="line">  std::string compressor_id = <span class="stringliteral">&quot;noop&quot;</span>;</div>
<div class="line">}</div>
<div class="ttc" id="aclasslibpressio__compressor__plugin_html"><div class="ttname"><a href="classlibpressio__compressor__plugin.html">libpressio_compressor_plugin</a></div><div class="ttdef"><b>Definition:</b> compressor.h:22</div></div>
<div class="ttc" id="aclasslibpressio__compressor__plugin_html_a2180d5ded80457937a4253ca792805b7"><div class="ttname"><a href="classlibpressio__compressor__plugin.html#a2180d5ded80457937a4253ca792805b7">libpressio_compressor_plugin::set_options_impl</a></div><div class="ttdeci">virtual int set_options_impl(struct pressio_options const &amp;options)=0</div></div>
<div class="ttc" id="aclasslibpressio__compressor__plugin_html_a3d2eda400213bf2a00d640328e6e8c75"><div class="ttname"><a href="classlibpressio__compressor__plugin.html#a3d2eda400213bf2a00d640328e6e8c75">libpressio_compressor_plugin::check_options_impl</a></div><div class="ttdeci">virtual int check_options_impl(struct pressio_options const &amp;)</div></div>
<div class="ttc" id="aclasslibpressio__compressor__plugin_html_ac7575b101042e5c216438e595af3c196"><div class="ttname"><a href="classlibpressio__compressor__plugin.html#ac7575b101042e5c216438e595af3c196">libpressio_compressor_plugin::get_configuration_impl</a></div><div class="ttdeci">virtual struct pressio_options get_configuration_impl() const =0</div></div>
<div class="ttc" id="aclasslibpressio__compressor__plugin_html_aebe330db97b251195ef853360dbf4d0d"><div class="ttname"><a href="classlibpressio__compressor__plugin.html#aebe330db97b251195ef853360dbf4d0d">libpressio_compressor_plugin::get_options_impl</a></div><div class="ttdeci">virtual struct pressio_options get_options_impl() const =0</div></div>
<div class="ttc" id="aclasslibpressio__compressor__plugin_html_afa06c343a62ff161e02c6b2a65fd31d6"><div class="ttname"><a href="classlibpressio__compressor__plugin.html#afa06c343a62ff161e02c6b2a65fd31d6">libpressio_compressor_plugin::clone</a></div><div class="ttdeci">virtual std::shared_ptr&lt; libpressio_compressor_plugin &gt; clone()=0</div></div>
<div class="ttc" id="aclasspressio__configurable_html_a4e23406b411d76d1a73460d32a7ead93"><div class="ttname"><a href="classpressio__configurable.html#a4e23406b411d76d1a73460d32a7ead93">pressio_configurable::set_meta</a></div><div class="ttdeci">void set_meta(pressio_options &amp;options, StringType &amp;&amp;key, std::string const &amp;current_id, Wrapper const &amp;current_value, Args &amp;&amp;... args) const</div><div class="ttdef"><b>Definition:</b> configurable.h:143</div></div>
<div class="ttc" id="aclasspressio__configurable_html_aa2b9ef24dd11b7c4a0678712567ab16a"><div class="ttname"><a href="classpressio__configurable.html#aa2b9ef24dd11b7c4a0678712567ab16a">pressio_configurable::prefix</a></div><div class="ttdeci">virtual const char * prefix() const =0</div></div>
<div class="ttc" id="aclasspressio__configurable_html_ab9878c5ada9274daae95d743277c04a9"><div class="ttname"><a href="classpressio__configurable.html#ab9878c5ada9274daae95d743277c04a9">pressio_configurable::set_name_impl</a></div><div class="ttdeci">virtual void set_name_impl(std::string const &amp;new_name)</div><div class="ttdef"><b>Definition:</b> configurable.h:46</div></div>
<div class="ttc" id="aclasspressio__configurable_html_acbd725596c83e011de4fcc23924c7526"><div class="ttname"><a href="classpressio__configurable.html#acbd725596c83e011de4fcc23924c7526">pressio_configurable::get_meta</a></div><div class="ttdeci">pressio_options_key_status get_meta(pressio_options const &amp;options, StringType &amp;&amp;key, Registry const &amp;registry, std::string &amp;current_id, Wrapper &amp;current_value)</div><div class="ttdef"><b>Definition:</b> configurable.h:257</div></div>
<div class="ttc" id="aclasspressio__errorable_html_ac88d68b1d28f24cf984fd2d2e7fc3bf4"><div class="ttname"><a href="classpressio__errorable.html#ac88d68b1d28f24cf984fd2d2e7fc3bf4">pressio_errorable::set_error</a></div><div class="ttdeci">int set_error(int code, std::string const &amp;msg)</div></div>
<div class="ttc" id="aclasspressio__versionable_html_a0d148c3274175e224786f2618db3804e"><div class="ttname"><a href="classpressio__versionable.html#a0d148c3274175e224786f2618db3804e">pressio_versionable::version</a></div><div class="ttdeci">virtual const char * version() const =0</div></div>
<div class="ttc" id="aclasspressio__versionable_html_a1f1a2cf24aa1371a752d764a63b833d9"><div class="ttname"><a href="classpressio__versionable.html#a1f1a2cf24aa1371a752d764a63b833d9">pressio_versionable::patch_version</a></div><div class="ttdeci">virtual int patch_version() const</div></div>
<div class="ttc" id="aclasspressio__versionable_html_aa18a0cf29f56b2ec2cdf242c22ce3786"><div class="ttname"><a href="classpressio__versionable.html#aa18a0cf29f56b2ec2cdf242c22ce3786">pressio_versionable::minor_version</a></div><div class="ttdeci">virtual int minor_version() const</div></div>
<div class="ttc" id="aclasspressio__versionable_html_af06e9af0f0af870c16358ca63596f6b9"><div class="ttname"><a href="classpressio__versionable.html#af06e9af0f0af870c16358ca63596f6b9">pressio_versionable::major_version</a></div><div class="ttdeci">virtual int major_version() const</div></div>
<div class="ttc" id="alibpressio__ext_2cpp_2pressio_8h_html_abdbb1e0c6163691c0f6be9a620d933fb"><div class="ttname"><a href="libpressio__ext_2cpp_2pressio_8h.html#abdbb1e0c6163691c0f6be9a620d933fb">compressor_plugins</a></div><div class="ttdeci">pressio_registry&lt; std::shared_ptr&lt; libpressio_compressor_plugin &gt; &gt; &amp; compressor_plugins()</div></div>
<div class="ttc" id="astructpressio__compressor_html"><div class="ttname"><a href="structpressio__compressor.html">pressio_compressor</a></div><div class="ttdef"><b>Definition:</b> compressor.h:307</div></div>
<div class="ttc" id="astructpressio__options_html"><div class="ttname"><a href="structpressio__options.html">pressio_options</a></div><div class="ttdef"><b>Definition:</b> options.h:352</div></div>
</div><!-- fragment --><p >Now to the harder part, writing compress and decompress.</p>
<p >First we can write our log and exponential transform functions.</p>
<div class="fragment"><div class="line"><span class="keyword">namespace </span>{</div>
<div class="line">  <span class="keyword">struct </span>log_fn{</div>
<div class="line">    <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;</div>
<div class="line">    <a class="code hl_struct" href="structpressio__data.html">pressio_data</a> operator()(T* begin, T* end) {</div>
<div class="line">        <a class="code hl_struct" href="structpressio__data.html">pressio_data</a> log_data = <a class="code hl_function" href="structpressio__data.html#a3f515cd75c19bb4e783853c2ae5fd961">pressio_data::clone</a>(*input);</div>
<div class="line">        <span class="keyword">auto</span> output_it = <span class="keyword">reinterpret_cast&lt;</span>T*<span class="keyword">&gt;</span>(log_data.<a class="code hl_function" href="structpressio__data.html#a3e895253d0cf47c7a7bbec7040508114">data</a>());</div>
<div class="line">        std::transform(begin, end, output_it, [](T i){ <span class="keywordflow">return</span> std::log(i); });</div>
<div class="line">        <span class="keywordflow">return</span> log_data;</div>
<div class="line">    }</div>
<div class="line">    <a class="code hl_struct" href="structpressio__data.html">pressio_data</a> <span class="keyword">const</span>* input;</div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">struct </span>exp_fn{</div>
<div class="line">    <span class="keyword">template</span> &lt;<span class="keyword">class</span> T&gt;</div>
<div class="line">    <a class="code hl_struct" href="structpressio__data.html">pressio_data</a> operator()(T* begin, T* end) {</div>
<div class="line">        <a class="code hl_struct" href="structpressio__data.html">pressio_data</a> log_data = <a class="code hl_function" href="structpressio__data.html#a3f515cd75c19bb4e783853c2ae5fd961">pressio_data::clone</a>(*output);</div>
<div class="line">        <span class="keyword">auto</span> output_it = <span class="keyword">reinterpret_cast&lt;</span>T*<span class="keyword">&gt;</span>(log_data.<a class="code hl_function" href="structpressio__data.html#a3e895253d0cf47c7a7bbec7040508114">data</a>());</div>
<div class="line">        std::transform(begin, end, output_it, [](T i){ <span class="keywordflow">return</span> std::exp(i); });</div>
<div class="line">        <span class="keywordflow">return</span> log_data;</div>
<div class="line">    }</div>
<div class="line">    <a class="code hl_struct" href="structpressio__data.html">pressio_data</a> <span class="keyword">const</span>* output;</div>
<div class="line">  };</div>
<div class="line">}</div>
<div class="ttc" id="astructpressio__data_html"><div class="ttname"><a href="structpressio__data.html">pressio_data</a></div><div class="ttdef"><b>Definition:</b> data.h:52</div></div>
<div class="ttc" id="astructpressio__data_html_a3e895253d0cf47c7a7bbec7040508114"><div class="ttname"><a href="structpressio__data.html#a3e895253d0cf47c7a7bbec7040508114">pressio_data::data</a></div><div class="ttdeci">void * data() const</div><div class="ttdef"><b>Definition:</b> data.h:327</div></div>
<div class="ttc" id="astructpressio__data_html_a3f515cd75c19bb4e783853c2ae5fd961"><div class="ttname"><a href="structpressio__data.html#a3f515cd75c19bb4e783853c2ae5fd961">pressio_data::clone</a></div><div class="ttdeci">static pressio_data clone(pressio_data const &amp;src)</div><div class="ttdef"><b>Definition:</b> data.h:209</div></div>
</div><!-- fragment --><p >We will use these methods using the <code>pressio_data_for_each</code> API to preform the transform Now, we can write compress and decompress:</p>
<div class="fragment"><div class="line"><span class="comment">//compress and decompress</span></div>
<div class="line"><span class="keywordtype">int</span> compress_impl(<a class="code hl_struct" href="structpressio__data.html">pressio_data</a> <span class="keyword">const</span>* input, <a class="code hl_struct" href="structpressio__data.html">pressio_data</a>* output)<span class="keyword"> override </span>{</div>
<div class="line">  <a class="code hl_struct" href="structpressio__data.html">pressio_data</a> log_input = pressio_data_for_each&lt;pressio_data&gt;(*input, log_fn{input});</div>
<div class="line">  <span class="keywordflow">return</span> check_error(compressor.<a class="code hl_variable" href="structpressio__compressor.html#a73cb4457ef16ddeec93271ee2130f3e6">plugin</a>-&gt;compress(&amp;log_input, output));</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> decompress_impl(<a class="code hl_struct" href="structpressio__data.html">pressio_data</a> <span class="keyword">const</span>* input, <a class="code hl_struct" href="structpressio__data.html">pressio_data</a>* output)<span class="keyword"> override </span>{</div>
<div class="line">  <span class="keywordtype">int</span> rc =  compressor.<a class="code hl_variable" href="structpressio__compressor.html#a73cb4457ef16ddeec93271ee2130f3e6">plugin</a>-&gt;decompress(input, output);</div>
<div class="line">  *output = pressio_data_for_each&lt;pressio_data&gt;(*output, exp_fn{output});</div>
<div class="line">  <span class="keywordflow">return</span> check_error(rc);</div>
<div class="line">}</div>
<div class="ttc" id="astructpressio__compressor_html_a73cb4457ef16ddeec93271ee2130f3e6"><div class="ttname"><a href="structpressio__compressor.html#a73cb4457ef16ddeec93271ee2130f3e6">pressio_compressor::plugin</a></div><div class="ttdeci">std::shared_ptr&lt; libpressio_compressor_plugin &gt; plugin</div><div class="ttdef"><b>Definition:</b> compressor.h:356</div></div>
</div><!-- fragment --><p >We finally register the library with libpressio:</p>
<div class="fragment"><div class="line"><span class="keyword">static</span> <a class="code hl_class" href="classpressio__register.html">pressio_register</a> X(<a class="code hl_function" href="libpressio__ext_2cpp_2pressio_8h.html#abdbb1e0c6163691c0f6be9a620d933fb">compressor_plugins</a>(), <span class="stringliteral">&quot;log&quot;</span>, [](){ <span class="keywordflow">return</span> std::make_unique&lt;log_transform&gt;();});</div>
<div class="ttc" id="aclasspressio__register_html"><div class="ttname"><a href="classpressio__register.html">pressio_register</a></div><div class="ttdef"><b>Definition:</b> pressio.h:105</div></div>
</div><!-- fragment --><p >High quality compressor modules may be accepted into libpressio. Contributed modules should be placed in to the <code>src/plugins/compressors/</code> directory and added to the main CMakeLists.txt. If the compressor plugin requires an external dependency, it should be hidden behind a configuration option. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.5
</small></address>
</body>
</html>
